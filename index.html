<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>äº†è§£è‡ªå·±çš„é ­çš®å•é¡Œï¼Œæ‰èƒ½å°ç—‡ä¸‹è—¥ï¼</title>
<script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

<!-- Noto Sans TC via Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap" rel="stylesheet">

<style>
  :root{
    --bg: #dbeaea;
    --accent: #004d4d;
    --card: #ffffff;
    --text: #111;
    --muted: #666;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: 'Noto Sans TC', "Microsoft JhengHei", sans-serif;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
  }
  .app{
    max-width:720px;
    margin:0 auto;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:stretch;
  }
  header{
    padding:18px;
    background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
    border-bottom:1px solid rgba(0,0,0,0.05);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  header h1{margin:0;font-size:18px;color:var(--accent)}
  .subtitle{font-size:13px;color:var(--muted)}
  main{padding:20px; flex:1;}
  .step{
    background:var(--card);
    border-radius:12px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    margin-bottom:16px;
  }
  .q-image{width:100%;height:180px;object-fit:cover;border-radius:8px;margin-bottom:12px;background:#f2f2f2;display:block}
  .question{font-weight:700;margin-bottom:12px;font-size:16px}
  .options{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  .option{
    padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);
    background:linear-gradient(180deg,#fff,#fbfbfb);
    cursor:pointer;text-align:center;
  }
  .option.selected{border-color:var(--accent);box-shadow:0 6px 18px rgba(0,77,77,0.06)}
  .controls{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-top:14px}
  button{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
  button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,0,0,0.06)}
  .small{font-size:13px;padding:8px 10px;border-radius:8px}
  .progress{height:8px;background:rgba(0,0,0,0.06);border-radius:999px;margin-bottom:12px;overflow:hidden}
  .progress>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#007b7b);width:0%}
  .results-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
  .card{background:var(--card);border-radius:10px;padding:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);display:flex;gap:10px;align-items:center}
  .card img{width:72px;height:72px;border-radius:8px;object-fit:cover}
  .card .info{flex:1}
  .card .title{font-weight:700;margin-bottom:6px}
  .card .desc{font-size:13px;color:var(--muted)}
  footer{padding:12px;text-align:center;border-top:1px solid rgba(0,0,0,0.03);background:transparent}
  .share{background:#00c300;color:#fff;border-radius:10px;padding:10px 12px;border:0;cursor:pointer;font-weight:700;display:inline-flex;align-items:center;gap:8px}
  .note{font-size:13px;color:var(--muted);margin-top:8px}
  @media (max-width:480px){
    .options{grid-template-columns:1fr}
    .results-grid{grid-template-columns:1fr}
    header{padding:12px}
    main{padding:12px}
    .q-image{height:140px}
  }
  .intro{
    background:var(--card);
    border-radius:12px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    text-align:center;
  }
  .intro img{width:100%;height:220px;object-fit:cover;border-radius:10px;margin-bottom:14px;background:#eee}
  .intro h2{margin:8px 0;color:var(--accent)}
  .start-btn{padding:12px 18px;border-radius:10px;background:var(--accent);color:#fff;border:0;cursor:pointer;font-weight:700}
</style>
</head>
<body>
<div class="app">
  
  <main id="main">
    <div class="progress"><i id="prog"></i></div>

    <div id="intro" class="intro">
      <img src="https://raw.githubusercontent.com/vececalls/LIFF-test/blob/main/Flowcharts/scalp%20check.jpg" alt="Intro image">
      <h2>äº†è§£è‡ªå·±çš„é ­çš®å•é¡Œï¼Œæ‰èƒ½å°ç—‡ä¸‹è—¥ï¼</h2>
      <p class="subtitle">å¿«é€Ÿæ¸¬é©— Â· å»ºè­°ç”¢å“æ¸…å–®</p>
      <div style="margin-top:14px">
        <button id="btn-start" class="start-btn">é–‹å§‹æ¸¬é©—</button>
      </div>
    </div>

    <div id="steps-container" style="display:none">
      <div class="step" data-step="1">
        <img class="q-image" src="https://via.placeholder.com/800x360?text=Question+1+Image" alt="question image">
        <div class="question">1) æ‚¨çš„ä¸»è¦é ­çš®å•é¡Œæ˜¯ï¼Ÿ</div>
        <div class="options" id="opt-problem">
          <div class="option" data-value="æ‰é«®">æ‰é«®</div>
          <div class="option" data-value="é ­çš®å±‘">é ­çš®å±‘</div>
          <div class="option" data-value="å‡ºæ²¹/çš®å±‘">å‡ºæ²¹/çš®å±‘</div>
          <div class="option" data-value="ä¹¾æ€§/é ­çš®å±‘">ä¹¾æ€§/é ­çš®å±‘</div>
          <div class="option" data-value="éæ•æ€§é ­çš®">éæ•æ€§é ­çš®</div>
        </div>
      </div>

      <div class="step" data-step="2" style="display:none">
        <img class="q-image" src="https://via.placeholder.com/800x360?text=Question+2+Image" alt="question image">
        <div class="question" id="q2-title">2) å­é¡Œ</div>
        <div class="options" id="opt-sub"></div>
      </div>

      <div class="step" data-step="3" style="display:none">
        <img class="q-image" src="https://via.placeholder.com/800x360?text=Question+3+Image" alt="question image">
        <div class="question">3) è«‹å•ï¼Œæ‚¨çš„é«®è³ª/é«®æ³ç‚ºä½•ï¼Ÿ</div>
        <div class="options" id="opt-hair">
          <div class="option" data-value="ç´°è»Ÿæ‰å¡Œé«®">ç´°è»Ÿæ‰å¡Œé«®</div>
          <div class="option" data-value="è™•å¥³é«®">è™•å¥³é«®</div>
          <div class="option" data-value="ä¹¾é»ƒæ¯ç‡¥é«®">ä¹¾é»ƒæ¯ç‡¥é«®</div>
          <div class="option" data-value="æŸ“ç‡™å¹æ•´é«®">æŸ“ç‡™å¹æ•´é«®</div>
        </div>
      </div>

      <div class="step" data-step="4" style="display:none">
        <div class="question">å»ºè­°çš„ç”¢å“</div>
        <div id="results-area">
          <div id="results-grid" class="results-grid"></div>
          <div class="note" id="results-note"></div>
        </div>
      </div>
    </div>

    <div class="controls">
      <div>
        <button class="ghost small" id="btn-back" style="visibility:hidden">ä¸Šä¸€æ­¥</button>
      </div>
      <div>
        <button id="btn-next">ä¸‹ä¸€æ­¥</button>
      </div>
    </div>
  </main>

  <footer>
    <button id="btn-share" class="share" style="display:none">ğŸ”— åˆ†äº«åˆ° LINE</button>
  </footer>
</div>

<script>
const LIFF_ID = "2008674690-pSGwzmNw";
const PRODUCTS = {
  scalpShampoo_hairfall_mild:{name:"ç´…è”˜è±é«®æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1631730486572-226d1f595b68?w=400&h=400&fit=crop",url:"#"},
  scalpShampoo_hairfall_moderate:{name:"å’–å•¡å› é«®æ ¹å¼·éŸŒæ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1631730486572-226d1f595b68?w=400&h=400&fit=crop",url:"#"},
  scalpShampoo_hairfall_severe:{name:"æ¤ç‰©å¤–æ³Œé«”å’–å•¡å› æ´»åŒ–é¤Šé«®æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1631730486572-226d1f595b68?w=400&h=400&fit=crop",url:"#"},
  scalpShampoo_dandruff_moderate:{name:"èŒ¶æ¨¹ OPT æŠ—å±‘æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1571875257727-256c39da42af?w=400&h=400&fit=crop",url:"#"},
  scalpShampoo_dandruff_severe:{name:"ç™¾é‡Œé¦™æŠ—å±‘æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1571875257727-256c39da42af?w=400&h=400&fit=crop",url:"#"},
  scalpShampoo_oily:{name:"é¼ å°¾è‰æ§æ²¹æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1571875257727-256c39da42af?w=400&h=400&fit=crop",url:"#"},
  scalpShampoo_dry:{name:"æ¾éœ²æŠ—å±‘æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1556228852-80c3a083d204?w=400&h=400&fit=crop",url:"#"},
  scalpShampoo_sensitive:{name:"éˆèŠèˆ’æ•æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  hairShampoo_fine:{name:"ç¶ æ´»çµ²æ¼¾æ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?w=400&h=400&fit=crop",url:"#"},
  hairShampoo_normal:{name:"è›‹ç™½è³ªæ´—é«®ç²¾",image:"https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?w=400&h=400&fit=crop",url:"#"},
  conditioner:{name:"é«®å…ƒç´ ",image:"https://images.unsplash.com/photo-1526045478516-99145907023c?w=400&h=400&fit=crop",url:"#"},
  semiTreatment_oily:{name:"é¼ å°¾è‰æ§æ²¹è­·é«®ç´ ",image:"https://images.unsplash.com/photo-1571875257727-256c39da42af?w=400&h=400&fit=crop",url:"#"},
  semiTreatment_dry:{name:"æ¾éœ²ä¿æ¿•è­·é«®ç´ ",image:"https://images.unsplash.com/photo-1571875257727-256c39da42af?w=400&h=400&fit=crop",url:"#"},
  scalpEssence_r3:{name:"R3 é ­çš®æ´»æ°§ç²¾è¯",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  scalpEssence_caffeine:{name:"å’–å•¡å› é«®æ ¹å¼·éŸŒè˜Šé«®ç²¾è¯",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  scalpEssence_exosome:{name:"æ¤ç‰©å¤–æ³Œé«”å’–å•¡å› æ¿€æ´»é¤Šé«®ç²¾è¯",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  scalpEssence_r2:{name:"R2 èŒ¶æ¨¹æŠ—å±‘ç²¾è¯",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  scalpEssence_r1:{name:"R1 é ­çš®é¤Šè­·ç²¾è¯",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  scalpEssence_revive:{name:"å¥é«®è³¦æ´»ç²¾è¯",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  scalpEssence_volume:{name:"å¥é«®è±ç›ˆç²¾è¯",image:"https://images.unsplash.com/photo-1620916566398-39f1143ab7be?w=400&h=400&fit=crop",url:"#"},
  proteinCream:{name:"è›‹ç™½è³ªè­·é«®éœœ",image:"https://images.unsplash.com/photo-1535585209827-a15fcdbc4c2d?w=400&h=400&fit=crop",url:"#"},
  shineSerum:{name:"æ™¶ç‡¦é«®éœ²",image:"https://images.unsplash.com/photo-1571875257727-256c39da42af?w=400&h=400&fit=crop",url:"#"},
  hairMask:{name:"ä¹³æ²¹æœ¨æ·±å±¤è­·é«®éœœ (æ¯3-7å¤©ä½¿ç”¨ä¸€æ¬¡)",image:"https://images.unsplash.com/photo-1556228852-80c3a083d204?w=400&h=400&fit=crop",url:"#"},
  hairTreatment:{name:"å¥‡è¹ŸæŸ”æ„ŸåŸæ¶²",image:"https://images.unsplash.com/photo-1619451334792-150fd785ee74?w=400&h=400&fit=crop",url:"#"}
};

let state={step:1,answers:{problem:null,sub:null,hair:null}};

function $(s){return document.querySelector(s)}
function $all(s){return Array.from(document.querySelectorAll(s))}

function setProgress(pct){const p=$('#prog'); if(p) p.style.width=pct+'%'}

function attachOptionHandlers(sel,key){
  let container=$(sel); if(!container) return;
  const parent=container.parentNode; const clone=container.cloneNode(true); parent.replaceChild(clone,container); container=clone;
  container.addEventListener('click',(e)=>{
    const opt=e.target.closest('.option'); if(!opt) return;
    $all(sel+' .option').forEach(el=>el.classList.remove('selected'));
    opt.classList.add('selected');
    state.answers[key]=opt.dataset.value;
    if(key==='problem') prepareConditional(opt.dataset.value);
  });
}

function prepareConditional(val){
  const q2title=$('#q2-title'); const q2opts=$('#opt-sub'); if(!q2opts) return;
  q2opts.innerHTML=''; state.answers.sub=null;
  if(val==='æ‰é«®'){
    q2title.textContent='2) è½é«®ç‹€æ³ï¼Ÿ';
    ['è¼•å¾®','ä¸­ç­‰','åš´é‡','æ¥µåº¦åš´é‡'].forEach(v=>{const d=document.createElement('div'); d.className='option'; d.dataset.value=v; d.textContent=v; q2opts.appendChild(d)});
    attachOptionHandlers('#opt-sub','sub');
  } else if(val==='é ­çš®å±‘'){
    q2title.textContent='2) é ­çš®å±‘ç‹€æ³ï¼Ÿ';
    ['ä¸­ç­‰','åš´é‡'].forEach(v=>{const d=document.createElement('div'); d.className='option'; d.dataset.value=v; d.textContent=v; q2opts.appendChild(d)});
    attachOptionHandlers('#opt-sub','sub');
  } else {
    q2opts.innerHTML='';
  }
}

function showStep(num){
  state.step=num;
  $all('[data-step]').forEach(el=>el.style.display=el.dataset.step==num? '':'none');
  $('#steps-container').style.display='block'; $('#intro').style.display='none';
  setProgress((num-1)/3*100);
  const back=$('#btn-back'); const next=$('#btn-next');
  next.style.display='inline-block';
  back.style.visibility=num===1? 'hidden':'visible';
  if(num===4){ next.textContent='é‡æ–°æ¸¬é©—'; $('#btn-share').style.display='inline-block'; setProgress(100) } else { next.textContent='ä¸‹ä¸€æ­¥'; $('#btn-share').style.display='none' }
  const statusEl=$('#status'); if(statusEl) statusEl.textContent=(window.liff && liff.isInClient())? 'åœ¨ LINE è£¡' : 'å¤–éƒ¨ç€è¦½å™¨';
}

function mapLogic(answers){
  const products=[]; const problem=answers.problem; const sub=answers.sub; const hair=answers.hair;
  function pushKeys(keys){ keys.forEach(k=>{ if(!products.includes(k)) products.push(k) }) }
  if(problem==='æ‰é«®'){
    let scalpKey='scalpShampoo_hairfall_mild'; let essence='scalpEssence_r3';
    if(sub==='è¼•å¾®'){scalpKey='scalpShampoo_hairfall_mild'; essence='scalpEssence_r3'}
    else if(sub==='ä¸­ç­‰'){scalpKey='scalpShampoo_hairfall_moderate'; essence='scalpEssence_caffeine'}
    else if(sub==='åš´é‡'){scalpKey='scalpShampoo_hairfall_severe'; essence='scalpEssence_exosome'}
    else if(sub==='æ¥µåº¦åš´é‡'){scalpKey='scalpShampoo_hairfall_severe'; essence='scalpEssence_exosome'}
    const hairSh=(hair==='ç´°è»Ÿæ‰å¡Œé«®')? 'hairShampoo_fine' : 'hairShampoo_normal';
    if(hair==='ç´°è»Ÿæ‰å¡Œé«®'){ pushKeys([scalpKey,hairSh,essence,'scalpEssence_volume','proteinCream','shineSerum','hairMask','hairTreatment']) }
    else { pushKeys([scalpKey,hairSh,'conditioner',essence,'proteinCream','shineSerum','hairMask','hairTreatment']) }
    return products;
  }
  if(problem==='é ­çš®å±‘'){
    const scalpKey = sub==='åš´é‡' ? 'scalpShampoo_dandruff_severe' : 'scalpShampoo_dandruff_moderate';
    const essence='scalpEssence_r2'; const hairSh=(hair==='ç´°è»Ÿæ‰å¡Œé«®')? 'hairShampoo_fine' : 'hairShampoo_normal';
    if(hair==='ç´°è»Ÿæ‰å¡Œé«®'){ pushKeys([scalpKey,hairSh,essence,'scalpEssence_volume','proteinCream','shineSerum','hairMask','hairTreatment']) }
    else { pushKeys([scalpKey,hairSh,'conditioner',essence,'proteinCream','shineSerum','hairMask','hairTreatment']) }
    return products;
  }
  if(problem==='å‡ºæ²¹/çš®å±‘'){
    const scalpKey='scalpShampoo_oily'; const semi='semiTreatment_oily'; const essence='scalpEssence_r1';
    const hairSh=(hair==='ç´°è»Ÿæ‰å¡Œé«®')? 'hairShampoo_fine' : 'hairShampoo_normal';
    if(hair==='ç´°è»Ÿæ‰å¡Œé«®'){ pushKeys([scalpKey,hairSh,semi,essence,'scalpEssence_volume','proteinCream','shineSerum','hairMask','hairTreatment']) }
    else { pushKeys([scalpKey,hairSh,semi,'conditioner',essence,'proteinCream','shineSerum','hairMask','hairTreatment']) }
    return products;
  }
  if(problem==='ä¹¾æ€§/é ­çš®å±‘'){
    const scalpKey='scalpShampoo_dry'; const semi='semiTreatment_dry'; const essence='scalpEssence_r2';
    const hairSh=(hair==='ç´°è»Ÿæ‰å¡Œé«®')? 'hairShampoo_fine' : 'hairShampoo_normal';
    if(hair==='ç´°è»Ÿæ‰å¡Œé«®'){ pushKeys([scalpKey,hairSh,semi,essence,'scalpEssence_volume','proteinCream','shineSerum','hairMask','hairTreatment']) }
    else { pushKeys([scalpKey,hairSh,semi,'conditioner',essence,'proteinCream','shineSerum','hairMask','hairTreatment']) }
    return products;
  }
  if(problem==='éæ•æ€§é ­çš®'){
    const scalpKey='scalpShampoo_sensitive'; const essence='scalpEssence_revive';
    const hairSh=(hair==='ç´°è»Ÿæ‰å¡Œé«®')? 'hairShampoo_fine' : 'hairShampoo_normal';
    if(hair==='ç´°è»Ÿæ‰å¡Œé«®'){ pushKeys([scalpKey,hairSh,essence,'scalpEssence_volume','proteinCream','shineSerum','hairMask','hairTreatment']) }
    else { pushKeys([scalpKey,hairSh,'conditioner',essence,'proteinCream','shineSerum','hairMask','hairTreatment']) }
    return products;
  }
  pushKeys(['scalpShampoo_hairfall_mild','hairShampoo_normal','scalpEssence_r3']);
  return products;
}

function renderResults(productKeys){
  const grid=$('#results-grid'); if(!grid) return; grid.innerHTML='';
  productKeys.forEach(k=>{ const p=PRODUCTS[k]; if(!p) return; const card=document.createElement('div'); card.className='card';
    card.innerHTML=`<img src="${p.image}" alt="${escapeHtml(p.name)}" /><div class="info"><div class="title">${escapeHtml(p.name)}</div><div class="desc">å»ºè­°ç”¢å“ â€¢ é»æ“ŠæŸ¥çœ‹</div></div>`;
    card.addEventListener('click', ()=>{ if(p.url && p.url!=='#') window.open(p.url,'_blank'); else alert(p.name+"\n(ç¤ºç¯„ç”¨ï¼Œè«‹é€£çµè‡³å•†å“é )"); });
    grid.appendChild(card);
  });
  const note=$('#results-note'); if(note) note.textContent="å»ºè­°ä¾åºï¼šé ­çš®æ´—é«®ç²¾ â†’ é«®è³ªæ´—é«®ç²¾ â†’ ç²¾è¯ â†’ è£œå……è­·é«®/é€ å‹ç­‰ã€‚è«‹ä¾å€‹äººéœ€æ±‚èª¿æ•´ã€‚";
}

function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }

$('#btn-next').addEventListener('click', ()=>{
  if(state.step===1){
    if(!state.answers.problem){ alert('è«‹é¸æ“‡ä¸»è¦é ­çš®å•é¡Œ'); return; }
    const p=state.answers.problem;
    if(p==='æ‰é«®' || p==='é ­çš®å±‘') showStep(2); else showStep(3);
  } else if(state.step===2){
    const p=state.answers.problem;
    if((p==='æ‰é«®' || p==='é ­çš®å±‘') && !state.answers.sub){ alert('è«‹é¸æ“‡å­é¡Œé¸é …'); return; }
    showStep(3);
  } else if(state.step===3){
    if(!state.answers.hair){ alert('è«‹é¸æ“‡é«®è³ª/é«®æ³'); return; }
    const keys=mapLogic(state.answers); renderResults(keys); showStep(4);
  } else if(state.step===4){
    resetQuiz(); $('#intro').style.display=''; $('#steps-container').style.display='none'; $('#btn-next').style.display='none'; setProgress(0);
  }
});

$('#btn-back').addEventListener('click', ()=>{
  if(state.step===2) showStep(1);
  else if(state.step===3){ const p=state.answers.problem; if(p==='æ‰é«®' || p==='é ­çš®å±‘') showStep(2); else showStep(1); }
  else if(state.step===4) showStep(3);
});

attachOptionHandlers('#opt-problem','problem');
attachOptionHandlers('#opt-hair','hair');

async function initLiff(){
  try{
    await liff.init({liffId:LIFF_ID});
    const statusEl=$('#status'); if(statusEl) statusEl.textContent = liff.isInClient() ? 'åœ¨ LINE å…§é–‹å•Ÿ' : 'ç€è¦½å™¨é–‹å•Ÿ';
    if(liff.isLoggedIn && liff.isLoggedIn()){ try{ await liff.getProfile() }catch(e){} }
  }catch(err){
    const statusEl=$('#status'); if(statusEl) statusEl.textContent='LIFF ç„¡æ³•è¼‰å…¥ (ä»å¯æ–¼ç€è¦½å™¨æ¸¬è©¦)';
  }
}

function resetQuiz(){
  $all('.option').forEach(el=>el.classList.remove('selected'));
  state={step:1,answers:{problem:null,sub:null,hair:null}};
  const s=$('#opt-sub'); if(s) s.innerHTML='';
  const g=$('#results-grid'); if(g) g.innerHTML='';
  const n=$('#results-note'); if(n) n.textContent='';
  $('#btn-share').style.display='none';
  $('#btn-next').style.display='none';
  setProgress(0);
}

$('#btn-share').addEventListener('click', async ()=>{
  const prodKeys=mapLogic(state.answers);
  const prodNames=prodKeys.slice(0,6).map(k=>PRODUCTS[k]?.name||k).join('ã€');
  const messageText=`æˆ‘åšäº†é ­çš®æª¢æ¸¬ï¼šä¸»è¨´ ${state.answers.problem} ${(state.answers.sub||'')}ã€é«®æ³ ${state.answers.hair}ã€‚ç³»çµ±æ¨è–¦ï¼š${prodNames}`;
  if(window.liff && liff.isInClient && liff.isInClient()){
    try{ await liff.shareTargetPicker([{type:'text',text:messageText}]); alert('å·²é–‹å•Ÿåˆ†äº«ä»‹é¢') }catch(e){ alert('åˆ†äº«å¤±æ•—ï¼Œè«‹ç¢ºèª LINE å…§é–‹å•Ÿ') }
  } else {
    try{ await navigator.clipboard.writeText(messageText); alert('æ¸¬é©—æ‘˜è¦å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œè«‹è²¼åˆ° LINE åˆ†äº«') }catch(e){ alert('ç„¡æ³•åˆ†äº«ï¼Œæ­¤åŠŸèƒ½åƒ…æ”¯æ´ LINE å…§é–‹å•Ÿæˆ–å‰ªè²¼ç°¿') }
  }
});

$('#btn-start').addEventListener('click', ()=>{
  $('#intro').style.display='none';
  $('#steps-container').style.display='block';
  $('#btn-next').style.display='inline-block';
  showStep(1);
  setProgress(0);
});

setProgress(0);
$('#btn-next').style.display='none';
initLiff();
</script>
</body>
</html>
